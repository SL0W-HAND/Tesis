% =================================================================
% Archivo de configuración para Diagramas de Penrose
% Contiene todos los paquetes, estilos y comandos necesarios.
% =================================================================

% --- Paquetes y librerías de TikZ ---
\usepackage{tikz}
\usetikzlibrary{babel}
\usepackage{amsmath} % para \text
\usepackage{mathrsfs} % para \mathscr
\usepackage{xfp} % para alta precisión en cálculos
\usetikzlibrary{patterns,patterns.meta}
\usepackage[outline]{contour} % para el contorno alrededor del texto
\usetikzlibrary{decorations.markings, decorations.pathmorphing}
\usetikzlibrary{angles, quotes} % para ángulos
\usetikzlibrary{arrows.meta} % para personalizar flechas
\contourlength{1.4pt}

% --- Definición de colores y estilos ---
\tikzset{>=latex} % Estilo de flecha por defecto
\colorlet{myred}{red!80!black}
\colorlet{myblue}{blue!80!black}
\colorlet{mygreen}{green!80!black}
\colorlet{mydarkred}{red!50!black}
\colorlet{mydarkblue}{blue!50!black}
\colorlet{mylightblue}{mydarkblue!6}
\colorlet{mypurple}{blue!40!red!80!black}
\colorlet{mydarkpurple}{blue!40!red!50!black}
\colorlet{mylightpurple}{mydarkpurple!80!red!6}
\colorlet{myorange}{orange!40!yellow!95!black}

\tikzstyle{cone}=[mydarkblue,line width=0.2,top color=blue!60!black!30,
bottom color=blue!60!black!50!red!30,shading angle=60,fill opacity=0.9]
\tikzstyle{cone back}=[mydarkblue,line width=0.1,dash pattern=on 1pt off 1pt]
\tikzstyle{world line}=[myblue!60,line width=0.4]
\tikzstyle{world line t}=[mypurple!60,line width=0.4]
\tikzstyle{particle}=[mygreen,line width=0.5]
\tikzstyle{photon}=[-{Latex[length=4,width=3]},myorange,line width=0.4,decorate,
decoration={snake,amplitude=0.9,segment length=4,post length=3.8}]
\tikzstyle{singularity}=[myred,line width=0.6,decorate,
decoration={zigzag,amplitude=2,segment length=6.17}]

% --- Comandos y funciones personalizadas ---
\newcommand{\calI}{\mathscr{I}}

\tikzset{declare function={%
penrose(\x,\c)  = {\fpeval{2/pi*atan( (sqrt((1+tan(\x)^2)^2+4*\c*\c*tan(\x)^2)-1-tan(\x)^2) /(2*\c*tan(\x)^2) )}};%
penroseu(\x,\t) = {\fpeval{atan(\x+\t)/pi+atan(\x-\t)/pi}};%
penrosev(\x,\t) = {\fpeval{atan(\x+\t)/pi-atan(\x-\t)/pi}};%
kruskal(\x,\c)  = {\fpeval{asin( \c*sin(2*\x) )*2/pi}};% Penrose coordinates for Kruskal
}}

\def\tick#1#2{\draw[thick] (#1) ++ (#2:0.04) --++ (#2-180:0.08)}
\def\Nsamples{40} % número de muestras en los gráficos

% --- Definiciones para los conos de luz ---
\def\R{0.08} % tamaño del cono de luz
\def\e{0.08} % escala vertical
\def\ang{45} % ángulo del cono de luz
\def\angb{acos(sqrt(\e)*sin(\ang))} % ángulo elipse
\def\a{\R*sin(\ang)*sqrt(1-\e*sin(\ang)^2)/(1-\e*sin(\ang)^2)} % radio vertical
\def\b{\R*sqrt(\e)*sin(\ang)*cos(\ang)/(1-\e*sin(\ang)^2)} % radio horizontal
\def\coneback#1{ % parte trasera del cono de luz
\draw[cone back] % dashed line back
(#1)++(-45:\R) arc({90-\angb}:{90+\angb}:{\a} and {\b});
\draw[cone,shading angle=-60] % top edge & inside
(#1)++(0,{\R*cos(\ang)/(1-\e*sin(\ang)^2)}) ellipse({\a} and {\b});
}
\def\conefront#1{ % parte frontal del cono de luz
\draw[cone] % light cone outside
(#1) --++ (45:\R) arc({\angb-90}:{-90-\angb}:{\a} and {\b})
--++ (-45:2*\R) arc({90-\angb}:{-270+\angb}:{\a} and {\b}) -- cycle;
}
\tikzset{declare function={% Kruskal-Szekeres coordinates
  sing(\x)        = {\fpeval{sqrt(\x*\x+1)}};%
  rstar(\c)       = {\fpeval{(\c/2-1)*exp(\c/2)}};%
  kruskalu(\x,\c) = {\fpeval{sqrt(\x*\x+(\c/2-1)*exp(\c/2))}};%
  kruskalv(\x,\c) = {\fpeval{sqrt(\x*\x-(\c/2-1)*exp(\c/2))}};%
}}
% --- Fin del archivo de configuración ---